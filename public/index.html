<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="viewport" content="user-scalable=1.0,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,width=device-width,minimal-ui">
        <link href="index.css" rel="stylesheet">
	<script src="https://uni-tap.github.io/uc/js/jquery-1.11.2.min.js"></script>
    </head>
    <body>
        <div class="board-top">
        <div class="board-top__left">
            <div class="board-top-left-panel board-panel--transparent board-panel--hidden-top">
                <div class="svg-button"><svg>&#10094;</svg></div>
                <div class="board-panel__splitter"></div>
                <div class="middle-panel board-top-left-panel__title--editable board-top-left-panel__title">Page - 1</div>
                <div class="board-panel__splitter"></div>
                <div class="svg-button"><svg>&#10094;</svg></div>
            </div>
        <div class="undo-redo board-panel--transparent board-panel--hidden-top">
            <div class="svg-button" id="undo">
                <svg viewBox="0 0 24 24" id="img__undo" width="100%" height="100%"><path d="M5 14.5C8.5 8 17.5 8 20 15M9.018 15H4l.018-5" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-width="2"></path></svg>
            </div>
            <div class="board-panel__splitter"></div>
            <div class="svg-button" id="redo">
                <svg viewBox="0 0 24 24" id="img__redo" width="100%" height="100%"><path d="M19 14.5C15.5 8 6.5 8 4 15m10.982 0H20l-.018-5" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-width="2"></path></svg>
            </div>
        </div>
        </div>
        <div class="board-top__right">
        <div class="board-top-right-panel board-panel--transparent board-panel--hidden-top">
            <button class="rtb-button red">End Class</button>
        </div>
        </div>    
        </div>
        <div class="canvasContextMenu canvasContextMenu-hor" style="display:none;">
            <div class="cm-items">
                <div class="icon-box"></div>
                <div class="icon-box"></div>
                <div class="icon-box"></div>
                <div class="icon-box"></div>
                <div class="icon-box"></div>
                <div class="icon-box"></div>
            </div>
        </div>
        <div class="tls_nav">
            <div class="toolbar__item">
                <div class="toolbar__item__inner">
                    <svg viewBox="0 0 24 24" id="img__cursor-24" width="100%" height="100%">
                        <path fill="currentColor" fill-rule="evenodd" d="M7 19l4.394-2.59 1.86 4.661a1 1 0 0 0 1.3.558l.499-.2a1 1 0 0 0 .557-1.3l-1.86-4.66L18.5 14 7 2v17z"></path>
                    </svg>
                </div>
            </div>
            <div class="board-toolbar__customized-box">
                <div class="toolbar__item toolbar__item--customized">
                <div class="toolbar__item__inner Text">
                    <svg viewBox="0 0 24 24" id="newlayout__text" width="100%" height="100%"><path fill="currentColor" fill-rule="evenodd" d="M3 5a1 1 0 0 0 1 1h6v14a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1V6h6a1 1 0 0 0 0-2H4a1 1 0 0 0-1 1z"></path></svg>
                </div>
            </div>
                <div class="toolbar__item toolbar__item--customized">
                <div class="toolbar__item__inner">
                    <svg viewBox="0 0 24 24" id="newlayout__sticker" width="100%" height="100%"><path fill="currentColor" d="M4 4v16h9v-5a2 2 0 0 1 2-2h5V4H4zm0-2h16a2 2 0 0 1 2 2v10.172a2 2 0 0 1-.586 1.414l-5.828 5.828a2 2 0 0 1-1.414.586H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"></path></svg>
                </div>
            </div>
                <div class="toolbar__item toolbar__item--customized" onclick="toggle('.toolbar__panel--shapes')">
                <div class="toolbar__item__inner Rectangle">
                    <svg viewBox="0 0 24 24" id="newlayout__shape-square" width="100%" height="100%"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2" d="M3 3h18v18H3z"></path></svg>
                </div>
            </div>
                <div class="toolbar__item toolbar__item--customized">
                <div class="toolbar__item__inner Line">
                    <svg viewBox="0 0 24 24" id="newlayout__link-arrow" width="100%" height="100%"><path fill="currentColor" d="M14.293 8.293l-11 11a1 1 0 0 0 1.414 1.414l11-11L18 12l3-9-9 3 2.293 2.293z"></path></svg>
                </div>
            </div>
                <div class="toolbar__item toolbar__item--customized" onclick="toggle('.toolbar__panel--draw')">
                <div class="toolbar__item__inner Pen">
                    <svg viewBox="0 0 24 24" id="newlayout__pen" width="100%" height="100%"><path fill="currentColor" fill-rule="evenodd" d="M22.086 4.586a2 2 0 0 1 0 2.828L9.914 19.586l-5.43 1.11a1 1 0 0 1-1.18-1.18l1.11-5.43L16.586 1.914a2 2 0 0 1 2.828 0l2.672 2.672zm-7.593 2.25l-8.24 8.24-.687 3.358 3.359-.687 8.24-8.24-2.672-2.671zm1.414-1.414l2.671 2.671L20.672 6 18 3.328l-2.093 2.094z"></path></svg>
                </div>
            </div>
                <div class="toolbar__item toolbar__item--customized">
                <div class="toolbar__item__inner">
                    <svg viewBox="0 0 24 24" id="newlayout__comment" width="100%" height="100%"><path fill="currentColor" d="M4 6v12.006L9.828 18 12 20.172 14.172 18h5.822L20 6H4zm0-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-5l-3 3-3-3H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm4 5a1 1 0 1 0 0 2h8a1 1 0 0 0 0-2H8zm0 4a1 1 0 0 0 0 2h8a1 1 0 0 0 0-2H8z"></path></svg>
                </div>
            </div>
                <div class="toolbar__item toolbar__item--customized">
                <div class="toolbar__item__inner">
                    <svg viewBox="0 0 24 24" id="newlayout__frames" width="100%" height="100%"><path fill="currentColor" fill-rule="evenodd" d="M6 5h12V3a1 1 0 0 1 2 0v2h2a1 1 0 0 1 0 2h-2v10h2a1 1 0 0 1 0 2h-2v2a1 1 0 0 1-2 0v-2H6v2a1 1 0 0 1-2 0v-2H2a1 1 0 0 1 0-2h2V7H2a1 1 0 1 1 0-2h2V3a1 1 0 1 1 2 0v2zm0 2v10h12V7H6z"></path></svg>
                </div>
            </div>
                <div class="toolbar__item toolbar__item--customized">
                <div class="toolbar__item__inner">
                    <svg viewBox="0 0 24 24" id="newlayout__upload" width="100%" height="100%"><path fill="currentColor" d="M11 11.914L9.414 13.5A1 1 0 1 1 8 12.086l4-4 4 4a1 1 0 0 1-1.414 1.414L13 11.914V21.5a1 1 0 0 1-2 0v-9.586zM16 20a1 1 0 0 1 1-1h3V4H4v15h3a1 1 0 0 1 0 2H3a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v17a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1z"></path></svg>
                </div>
            </div>
            </div>
            <div class="toolbar__panel toolbar__panel--shapes use-ng-animate" style="top: 16px;display:none;">
                <div class="toolbar__panel__item Rectangle"> 
                <svg class="icon"> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#newlayout__shape-square" ng-attr-xlink:href="{{shapeTool.icon}}"></use> </svg> 
                </div>
                <div class="toolbar__panel__item"> 
                    <svg viewBox="0 0 24 24" id="newlayout__shape-rounded" width="100%" height="100%"><path fill="currentColor" d="M7 4a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm0-2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5z"></path></svg> 
                </div>
                <div class="toolbar__panel__item Circle"> 
                    <svg viewBox="0 0 24 24" id="newlayout__shape-oval" width="100%" height="100%"><circle cx="12" cy="12" r="9" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"></circle></svg> 
                </div>
                <div class="toolbar__panel__item Triangle"> 
                    <svg viewBox="0 0 24 24" id="newlayout__shape-triangle" width="100%" height="100%"><path fill="currentColor" d="M12 4.922L4.197 19h15.606L12 4.922zm.875-2.58l9.484 17.175A1 1 0 0 1 21.484 21H2.516a1 1 0 0 1-.875-1.483l9.483-17.175a1 1 0 0 1 1.751 0z"></path></svg>
                </div>
                <div class="toolbar__panel__item" > 
                    <svg viewBox="0 0 24 24" id="newlayout__shape-rhombus" width="100%" height="100%"><path fill="currentColor" d="M12 2.617L2.617 12 12 21.383 21.383 12 12 2.617zm.707-2.121l10.797 10.797a1 1 0 0 1 0 1.414L12.707 23.504a1 1 0 0 1-1.414 0L.496 12.707a1 1 0 0 1 0-1.414L11.293.496a1 1 0 0 1 1.414 0z"></path></svg> 
                </div>
                <div class="toolbar__panel__item">
                    <svg viewBox="0 0 24 24" id="newlayout__shape-babble" width="100%" height="100%"><path fill="currentColor" d="M13.073 19l-4.646 3.65A1.5 1.5 0 0 1 6 21.472V19a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5h12a5 5 0 0 1 5 5v7a5 5 0 0 1-5 5h-4.927zM8 20.443L12.381 17H18a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H6a3 3 0 0 0-3 3v7a3 3 0 0 0 3 3h2v3.443z"></path></svg> 
                </div>
                <div class="toolbar__panel__item" > 
                    <svg viewBox="0 0 24 24" id="newlayout__shape-parall" width="100%" height="100%"><path fill="currentColor" d="M6.463 5L2.544 19h14.993l3.919-14H6.463zm-.758-2h17.07a1 1 0 0 1 .962 1.27l-4.479 16a1 1 0 0 1-.963.73H1.225a1 1 0 0 1-.962-1.27l4.479-16A1 1 0 0 1 5.705 3z"></path></svg>
                </div>
            </div>
            <div class="toolbar__panel toolbar__panel--draw" style="display: none;">
                <div class="draw-tools-box">
                    <div class="svg-button Pen">
                        <svg viewBox="0 0 24 24" id="newlayout__pen" width="100%" height="100%"><path fill="currentColor" fill-rule="evenodd" d="M22.086 4.586a2 2 0 0 1 0 2.828L9.914 19.586l-5.43 1.11a1 1 0 0 1-1.18-1.18l1.11-5.43L16.586 1.914a2 2 0 0 1 2.828 0l2.672 2.672zm-7.593 2.25l-8.24 8.24-.687 3.358 3.359-.687 8.24-8.24-2.672-2.671zm1.414-1.414l2.671 2.671L20.672 6 18 3.328l-2.093 2.094z"></path></svg>
                    </div>
                <div class="svg-button Eraser">
                        <svg viewBox="0 0 24 24" id="newlayout__eraser" width="100%" height="100%"><path fill="currentColor" fill-rule="evenodd" d="M18 19a1 1 0 0 1 0 2H5.586l-2.879-2.879a3 3 0 0 1 0-4.242L12.88 3.707a3 3 0 0 1 4.242 0l4.172 4.172a3 3 0 0 1 0 4.242L14.414 19H18zm-1.707-4.707l-5.586-5.586-6.586 6.586a1 1 0 0 0 0 1.414L6.414 19h5.172l4.707-4.707z"></path></svg>
                    </div>
                <div class="svg-button draw-tools-box__close" onclick="toggle('.toolbar__panel--draw')">
                        <svg viewBox="0 0 24 24" id="img__close-24" width="100%" height="100%"><path fill="currentColor" d="M10.586 12l-6.293 6.293a1 1 0 0 0 1.414 1.414L12 13.414l6.293 6.293a1 1 0 0 0 1.414-1.414L13.414 12l6.293-6.293a1 1 0 1 0-1.414-1.414L12 10.586 5.707 4.293a1 1 0 0 0-1.414 1.414L10.586 12z"></path></svg>
                    </div>
                </div>
                <div class="colorPalette">
                    <div class="btn colorPalette_circle white" style="background-color:white;"></div>
                    <div class="btn colorPalette_circle yellow" style="background-color:yellow;"></div>
                    <div class="btn colorPalette_circle #fac710;" style="background-color:#fac710;"></div>
                    <div class="btn colorPalette_circle rgb(242, 71, 38)" style="background-color:rgb(242, 71, 38);"></div>
                    <div class="btn colorPalette_circle rgb(230, 230, 230)" style="background-color:rgb(230, 230, 230);"></div>
                    <div class="btn colorPalette_circle rgb(206, 231, 65)" style="background-color:rgb(206, 231, 65);"></div>
                    <div class="btn colorPalette_circle rgb(143, 209, 79)" style="background-color:rgb(143, 209, 79);"></div>
                    <div class="btn colorPalette_circle rgb(218, 0, 99)" style="background-color:rgb(218, 0, 99);"></div>
                    <div class="btn colorPalette_circle rgb(128, 128, 128)" style="background-color:rgb(128, 128, 128);"></div>
                    <div class="btn colorPalette_circle rgb(18, 205, 212)" style="background-color:rgb(18, 205, 212);"></div>
                    <div class="btn colorPalette_circle rgb(12, 167, 137)" style="background-color:rgb(12, 167, 137);"></div>
                    <div class="btn colorPalette_circle rgb(149, 16, 172)" style="background-color:rgb(149, 16, 172);"></div>
                    <div class="btn colorPalette_circle rgb(26, 26, 26)" style="background-color:rgb(26, 26, 26);"></div>
                    <div class="btn colorPalette_circle rgb(45, 155, 240)" style="background-color:rgb(45, 155, 240);"></div>
                    <div class="btn colorPalette_circle rgb(65, 75, 178)" style="background-color:rgb(65, 75, 178);"></div>
                    <div class="btn colorPalette_circle rgb(101, 44, 179)" style="background-color:rgb(101, 44, 179);"></div>
                </div>
            </div>
            </div>
        <div class="bottom-bar board-panel--transparent board-panel--hidden-bottom">
            <div class="bottom-bar__inner" style="display:flex;">
                <div class="svg-button">
                    <svg viewBox="0 0 24 24" id="img__presentation" width="100%" height="100%"><path fill="currentColor" d="M17.667 19L19 23h-2l-1.333-4H8.333L7 23H5l1.333-4H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7V2a1 1 0 0 1 2 0v1h7a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-2.333zM4 5v12h16V5H4zm6 3l4.5 3-4.5 3V8z"></path></svg>
                </div>
                <div class="svg-button">
                    <svg viewBox="0 0 24 24" id="img__chat" width="100%" height="100%"><path fill="currentColor" fill-rule="evenodd" d="M21 15h-5v3a2 2 0 0 1-2 2H3l-3 3V10a2 2 0 0 1 2-2h4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v13l-3-3zM2 10v8h12v-8H2zm6-5v3h6a2 2 0 0 1 2 2v3h6V5H8z"></path></svg>
                </div>
                <div class="svg-button">
                    <svg viewBox="0 0 24 24" id="img__comments-list" width="100%" height="100%"><path fill="currentColor" d="M4 6v12.006L9.828 18 12 20.172 14.172 18h5.822L20 6H4zm0-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-5l-3 3-3-3H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm7 5a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2h-6zm0 4a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2h-6zM7 9a1 1 0 1 0 0 2h1a1 1 0 0 0 0-2H7zm0 4a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2H7z"></path></svg>
                </div>
            </div>
            <div onclick="toggle('.bottom-bar__inner')" class="bottom-bar__toggle svg-button">
                <svg viewBox="0 0 24 24" id="img__scroll-up" width="100%" height="100%"><path d="M9 17l3-3 3 3m-6-6l3-3 3 3" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-width="2"></path></svg>
            </div>
        </div>
        <div class="video-chat board-panel--transparent board-panel--hidden-bottom video-chat--pinned video-chat--with-buttons">
            <div class="video-cont">
                <div id="localVideo"></div>
                <div id="remoteVideos"></div>
            </div>
            <div class="video-controls"></div>
        </div>
        <canvas id="canvas" class="whiteboard" oncontextmenu="return false;" width="1920" height="959"></canvas>
        <canvas id="page1" class="storeboard" width="1920" height="959"></canvas>
    </body>
    <script src="https://unitap-ink.herokuapp.com/main.js"></script>
    <script src="main.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://simplewebrtc.com/latest-v2.js"></script> 
    <script>
        function toggle(elem){
            var obj = document.querySelector(elem);
            if(obj.style.display == 'none'){
              obj.style.display = 'block';
            }else if(obj.style.display == 'block'){
              obj.style.display = 'none';
            }
        }
	    $(function() {
    var socket = io.connect();
    var $messageForm = $('#messageForm');
    var $message = $('#message');
    var $chat = $('#chat');
    var $users = $('#users');
    var name = find('user');
    name = name.replace(/%20/g, " ");
    var post = '(' + find('post') + ')';
    var username = name + " " + post;
    var chat_area = document.querySelector('.chat_area');
    if (find('post') != 'ADMIN') {
      socket.emit('new_user', username, function(data) {
        data = username;
        //username = '<%= session.getAttribute("decname") %>';
        toast(username + ' has joined the class.');
      });
    }
	    });
  document.getElementById('div').addEventListener('click', function() {
    document.getElementById('div').className += ' div';
  });
  if (find('post') == 'S' || find('post') == 's') {
    document.querySelector('.min_box').style.display = 'block';
    document.querySelector('#tls_desk').style.display = 'none';
  }
  function startTime() {
    var today = new Date();
    var h = today.getHours();
    var m = today.getMinutes();
    var s = today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    h = h % 12;
    document.getElementById('date').innerHTML =
      h + ":" + m + ":" + s;
    if (navigator.onLine == false) {
      document.querySelector('.no_conn').style.display = 'block';
    } else {
      document.querySelector('.no_conn').style.display = 'none';
    }
    var t = setTimeout(startTime, 500);
    if (m == '00') {
      if (s == '00') {
        toogle('#clckcont');
        toast(document.getElementById('date').innerHTML);
        setTimeout(function() {
             toogle('#clckcont');
        }, 3000);
      }
    }
  }
  function checkTime(i) {
    if (i < 10) {
      i = "0" + i
    }; // add zero in front of numbers < 10
    return i;
  }
  var socket = io();
  var api = find('api');
  var room_id = 'uni-tap_live_classes: Live_Class_Id: ' + api;
  var hoster = find('hostedby');
  var title = find('title');
  var user = find('user');
  title = title.replace('%20', ' ');
  window.onload = function() {
    var stateObj = {
      foo: "bar"
    };
    //history.pushState(stateObj, "page 2", "uni-tap_live_class_going_on.->This_Class_Is_Being_Hosted_By:"+hoster);
    startTime();
    toast('Welcome to the ' + title + ' 😃 ');
    var post_tools = find('post');
    if (post_tools == 's' || post_tools == 'S') {
      //toogle('#tls_desk');
      if (document.getElementById('date').innerHTML > find('s_time')) {
        socket.emit('late', {
          user: user,
          api: api
        });
      }
    }
  }
  function add_user_to_list(){
    socket.emit('add_usr', {
      api: find('api'),
      user: find('user'),
      id: find('id'),
      post: find('post')
    });
    console.log('done_add');
  }
  
  socket.on('add_usr', function(){
    if(data.api == find('api')){
      if(data.user != find('user')){
        add_to_list(data.user, data.id, data.post);
      }else{
        return;
      }
    }else{
      return;
    }
    console.log('done_add');
  });
  
  function add_to_list(user, id, post){
    var list = document.querySelector('#tot_usr');
    var item = document.createElement('li');
        item.innerHTML = '<img src="http://uni-tap.co/nusr/dp.php?id='+data.id+'"'+data.user+' ('+data.post+' )';
        list.appendChild(item);
  }
  // OTHER IMPORTANT FUNCTIONS
  function get(id, condition) {
    document.querySelector(id).style.display = condition;
  }
  function find(name) {
    var url = window.location.search;
    var num = url.search(name);
    var namel = name.length;
    var frontlength = namel + num + 1; //length of everything before the value
    var front = url.substring(0, frontlength);
    url = url.replace(front, "");
    num = url.search("&");
    if (num >= 0) return url.substr(0, num);
    if (num < 0) return url;
  }
  function toast(msg) {
    var x = document.getElementById("snackbar")
    x.className = "show";
    x.innerHTML = msg;
    setTimeout(function() {
      x.className = x.className.replace("show", "");
    }, 3000);
  }
  function hide() {
    var tools_desk = document.getElementById('tls_desk');
    setTimeout(function() {
      tools_desk.style.bottom = '-150px', 3000
    });
  }
  function show() {
    document.getElementById('video').getElementsByTagName('video')[0].setAttribute('controls', '');
    var tools_desk = document.getElementById('tls_desk');
    setTimeout(function() {
      tools_desk.style.bottom = '-50px', 3000
    });
  }
  function toogle(obj) {
    var element = document.querySelector(obj);
    if (element.style.display == 'none') {
      element.style.display = 'block';
    } else {
      element.style.display = 'none';
    }
  }
  function get_elm(obj) {
    var elm = document.querySelector(obj);
    return elm;
  }
  function do_essentials() {
    //function only for book loader
    //get_elm('#tls_desk').style.height = '100%';
    //get_elm('#tls_desk').onmouseover = '';
    //get_elm('#tls_desk').onmouseout = '';
    var input = document.getElementById("filer");
    var file = input.value.split("\\");
    var fileName = file[file.length - 1];
    //alert(file);
    //toogle('#video');
    //toogle('#chat');
    toogle_pro('#bookloader');
    // if(get_elm('#book_area').src == '' || !get_elm('#book_area').src ){
    //  get_elm('#book_area').src = 'http://localhost/firebase/Chapter1-Matter In Our Surroundings.pdf';
    //    }else{}
  }
  function toogle_pro(obj) {
    var element = document.querySelector(obj);
    if (element.style.display == 'none') {
      element.style.display = 'block';
    } else {
      element.style.display = 'block';
    }
  }
  function animate() {
    this.style.fontSize = 'x-large';
    setTimeout(1000, function() {
      this.style.fontSize = 'large';
    });
  }
  function open_book(url) {
    do_essentials();
    get_elm('#book_area').src = url;
    toogle('.book_select');
  }
  function back() {
    //function only for book loader
    var desk = get_elm('#tls_desk');
    desk.style.height = '180px';
    desk.addEventListener('mouseover', show);
    desk.addEventListener('mouseout', hide);
    get_elm('#bookloader').style.display = 'none';
  }
  $(function() {
    var socket = io.connect();
    var $messageForm = $('#messageForm');
    var $message = $('#message');
    var $chat = $('#chat');
    var $users = $('#users');
    var name = find('user');
    name = name.replace(/%20/g, " ");
    var post = '(' + find('post') + ')';
    var username = name + " " + post;
    var chat_area = document.querySelector('.chat_area');
    if (find('post') != 'ADMIN') {
      socket.emit('new_user', username, function(data) {
        data = username;
        //username = '<%= session.getAttribute("decname") %>';
        toast(username + ' has joined the class.');
      });
    }
    $messageForm.submit(function(e) {
      e.preventDefault();
      snd_chat(document.getElementById('message').value);
      //socket.emit('send message', $message.val());
      $message.val('');
    });
    if (find('post') != 'ADMIN') {
      socket.on('new_user', function(data) {
        toast(data[i] + ' has joined the class.');
      });
    }
    socket.on('new message', function(data) {
      if (document.getElementById('chat').style.display == 'none') {
        toast(data.user + ':' + data.msg + "<p style='color:lime;' id='rep'>REPLY</p>")
        //document.getElementById('rep').addEventListener('click', toogle('#chat'), false);
        $chat.append('<li class="chtcnt" focus><strong>' + data.user + ':</strong> ' + data.msg + '</li>')
        $chat.scrollTop = $chat.scrollHeight;
      } else {
        $chat.append('<li class="chtcnt" focus><strong>' + data.user + ':</strong> ' + data.msg + '</li>')
        $chat.scrollTop = $chat.scrollHeight;
      }
    });
    socket.on('get users', function(data) {
      var html = '';
      for (i = 0; i < data.length; i++) {
        html += '<li class="userlist"><strong>' + data[i] + '</strong></li>';
        if (find('post') != 'ADMIN') {
          toast(data[i] + ' has joined the class.');
        }
      }
      $users.html(html);
    });
    socket.on('reload', function() {
      setTimeout(2000, window.reload(true));
    });
  });
  window.addEventListener('reload', function() {
    socket.emit('reload');
  });
  //VIDEO AND AUDIO CHATTING AREA
  var webrtc = new SimpleWebRTC({
    // the id/element dom element that will hold "our" video
    localVideoEl: 'localVideo',
    // the id/element dom element that will hold remote videos
    remoteVideosEl: 'remotesVideos',
    // immediately ask for camera access
    autoRequestMedia: true
  });
  // we have to wait until it's ready
  webrtc.on('readyToCall', function() {
    // you can name it anything
    webrtc.joinRoom(room_id);
  });
  //ENDING CLASS
  socket.on('end_class', onEnd_class);
  var e_api = find('api');
  var host = find('hostedby');
  var user = find('user');
  var post = find('post');
  function end_class() {
    if (post == 's' || post == 'S') {
      return;
    } else {
      /*  window.onbeforeunload =  function() {
                  return "Do you really want to end the class?";
        }  */
      socket.emit('end_class', 'end');
      toast('This Class is now over by:' + user, 'warn');
      setTimeout(function() {
        //window.location.replace('http://uni-tap.co/end_class.php?api=' +e_api+'&host='+host+'&user='+user)
        window.location.replace('http://uni-tap.co/index.php');
      }, 3050);
      //window.location.replace('https://uni-tap.github.io/end_class.php?api=' +e_api+'&host='+host+'&user='+user);
    }
  }
  function onEnd_class(data) {
    if (post == 's' || post == 'S') {
      return;
    } else {
      toast('This Class is now over 😌');
      setTimeout(function() {
        //window.location.replace('http://uni-tap.co/end_class.php?api=' +e_api+'&host='+host+'&user='+user)
        window.location.replace('http://uni-tap.co/index.php');
      }, 3050);
    }
  }
  var box = document.querySelector('#msg_box');
  /*function toast(msg){
    document.getElementById('msg_p').innerHTML = msg;
    //remove_toast()
    setTimeout(function(){
    box.style.opacity = '0'
    box.style.display = 'none'
    },
    5000
  );;
  }*/
  function remove_toast() {
    console.log('done');
  }
  function img() {
    toogle('#img_up_box');
  }
  function vid() {
    toogle('#vid_up_box');
  }
  //NEW CHAT
  function snd_chat(chat) {
    var li = document.createElement('li');
    li.className = 's_msg';
    var user = find('user');
    li.innerHTML = chat;
    var chat_a = document.querySelector('#chat');
    chat_a.appendChild(li);
    //var chat_msg_t_S =
    socket.emit('chat_msg', {
      chat: chat,
      user: user,
      id: find('id'),
      api: find('api')
    });
  }
  socket.on('chat_msg', function(data) {
    if (data.api == find('api')) {
      if (data.user != find('user')) {
        if (document.getElementById('chat_ar').style.display == 'none') {
          notifyMe(data.user + ':' + data.chat, "http://uni-tap.co/nusr/dp.php?id=" + data.id);
          var li = document.createElement('li');
          li.className = 'r_msg';
          li.innerHTML = '<img class="cht_usr_img" onerror="standby()" src="http://uni-tap.co/nusr/dp.php?id=' + data.id + '" height="20" width="20"><p style="font-size: 10px;position: absolute;top: -15px;left: 7px;color: #bdb6b6;">' + data.user +
            '</p>' + data.chat;
          var chat = document.querySelector('#chat');
          chat.appendChild(li);
        } else {
          var li = document.createElement('li');
          li.className = 'r_msg';
          li.innerHTML = '<img class="cht_usr_img" onerror="standby()" src="http://uni-tap.co/nusr/dp.php?id=' + data.id + '" height="20" width="20"><p style="font-size: 10px;position: absolute;top: -15px;left: 7px;color: #bdb6b6;">' + data.user +
            '</p>' + data.chat;
          var chat = document.querySelector('#chat');
          chat.appendChild(li);
        }
      } else {
        return;
      }
    } else {
      reurn;
    }
  });
  function standby() {
    this.src = 'https://ssl.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png';
  }
  // request permission on page load
  document.addEventListener('DOMContentLoaded', function() {
    if (Notification.permission !== "granted")
      Notification.requestPermission();
  });
  function notifyMe(body, icon) {
    if (!Notification) {
      alert('Desktop notifications not available in your browser. Try Chromium.');
      return;
    }
    if (Notification.permission !== "granted")
      Notification.requestPermission();
    else {
      var notification = new Notification('New Message', {
        icon: icon,
        body: body
      });
      notification.onclick = function() {
        //window.open("http://stackoverflow.com/a/13328397/1269037");
      };
    }
  }
</script>
 
</html>
